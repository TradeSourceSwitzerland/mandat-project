<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zevix – ROI Calculator</title>
</head>
<body>

<section id="roi-calculator">
  <div>
    <label>Leads pro Monat: <span id="leadsValue">500</span></label>
    <input type="range" id="leadsSlider" min="500" max="4500" step="50" value="500" oninput="calculate()" />
  </div>
  <div>
    <label>Conversion Rate: <span id="conversionValue">2%</span></label>
    <input type="range" id="conversionSlider" min="0.5" max="10" step="0.1" value="2" oninput="calculate()" />
  </div>
  <div>
    <label>Umsatz pro Kunde (CHF):
      <input type="number" id="revenueInput" min="100" value="500" oninput="calculate()" />
    </label>
  </div>

  <div id="results">
    <p>Neue Kunden: <span id="newCustomers">--</span></p>
    <p>Monatlicher Umsatz: <span id="monthlyRevenue">CHF --</span></p>
    <p>Jährlicher Umsatz: <span id="yearlyRevenue">CHF --</span></p>
    <p>ROI: <span id="roi">--%</span></p>
    <p>Plan: <span id="planName">--</span></p>
  </div>
</section>

<script>
  const leadsSlider = document.getElementById('leadsSlider');
  const conversionSlider = document.getElementById('conversionSlider');
  const revenueInput = document.getElementById('revenueInput');
  const leadsValue = document.getElementById('leadsValue');
  const conversionValue = document.getElementById('conversionValue');
  const newCustomers = document.getElementById('newCustomers');
  const monthlyRevenue = document.getElementById('monthlyRevenue');
  const yearlyRevenue = document.getElementById('yearlyRevenue');
  const roi = document.getElementById('roi');
  const planName = document.getElementById('planName');

  function formatNumber(num) {
    return Math.round(num).toLocaleString('de-CH');
  }

  function updateSliderBackground(slider, value, min, max) {
    const pct = ((value - min) / (max - min)) * 100;
    slider.style.background = `linear-gradient(to right, #4f46e5 ${pct}%, #e5e7eb ${pct}%)`;
  }

  async function calculate() {
    const leads = parseInt(leadsSlider.value);
    const conversion = parseFloat(conversionSlider.value);
    const revenue = parseInt(revenueInput.value) || 0;

    // UI Update (sofort)
    leadsValue.textContent = formatNumber(leads);
    conversionValue.textContent = conversion + '%';
    updateSliderBackground(leadsSlider, leads, 500, 4500);
    updateSliderBackground(conversionSlider, conversion, 0.5, 10);

    try {
      // API Call zum Backend
      const response = await fetch('/api/calculate-roi', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ leads, conversion, revenue })
      });

      if (!response.ok) throw new Error(`API Fehler: ${response.status} ${response.statusText}`);

      const data = await response.json();

      // UI Update mit Backend-Daten
      newCustomers.textContent = formatNumber(data.customers);
      monthlyRevenue.textContent = 'CHF ' + formatNumber(data.monthly);
      yearlyRevenue.textContent = 'CHF ' + formatNumber(data.yearly);
      roi.textContent = formatNumber(data.roi) + '%';
      planName.textContent = data.plan + ' · CHF ' + data.subscriptionCost + '/Monat';

      // Animation
      [newCustomers, monthlyRevenue, yearlyRevenue, roi].forEach(el => {
        el.classList.remove('highlight-result');
        void el.offsetWidth;
        el.classList.add('highlight-result');
      });

    } catch (error) {
      console.error('Fehler beim Berechnen:', error);
      // Fallback UI
      newCustomers.textContent = '--';
      monthlyRevenue.textContent = 'CHF --';
      yearlyRevenue.textContent = 'CHF --';
      roi.textContent = '--%';
      planName.textContent = 'Fehler - Bitte neu laden';
    }
  }

  // Initial calculation on page load
  calculate();
</script>

</body>
</html>
